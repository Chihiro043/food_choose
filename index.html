<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ğŸ½ï¸ ä»Šå¤©åƒä»€éº¼ï¼Ÿ</title>
  <style>
    body {
      font-family: 'Microsoft JhengHei', sans-serif;
      background-color: #f8f3ed;
      color: #5c4b3b;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    header, footer {
      background-color: #a66b3c;
      color: white;
      width: 100%;
      text-align: center;
      padding: 10px;
    }
    nav {
      background-color: #d9b382;
      width: 100%;
      display: flex;
      justify-content: center;
      gap: 20px;
      padding: 10px 0;
    }
    nav a {
      color: white;
      text-decoration: none;
      font-weight: bold;
    }
    nav a:hover {
      text-decoration: underline;
    }
    main {
      width: 90%;
      max-width: 600px;
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 20px 0;
    }
    .meal-buttons {
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .meal-buttons button {
      padding: 10px 20px;
      background-color: #d9b382;
      border: none;
      border-radius: 10px;
      color: white;
      cursor: pointer;
      font-size: 16px;
    }
    .meal-buttons button.active {
      background-color: #a66b3c;
    }
    .wheel-container {
      margin: 30px 0 10px;
      position: relative;
      width: 300px;
      height: 300px;
    }
    canvas {
      width: 300px;
      height: 300px;
      border: 3px solid #a66b3c;
      border-radius: 50%;
    }
    .arrow {
      position: absolute;
      top: 50%;
      right: -30px;
      transform: translateY(-50%) rotate(180deg);
      width: 0;
      height: 0;
      border-top: 20px solid transparent;
      border-bottom: 20px solid transparent;
      border-left: 30px solid #a66b3c;
      z-index: 10;
    }
    .spin-button {
      padding: 10px 30px;
      font-size: 18px;
      background-color: #a66b3c;
      color: white;
      border: none;
      border-radius: 12px;
      cursor: pointer;
    }
    #result {
      text-align: center;
      font-size: 20px;
      margin-top: 20px;
      color: #a66b3c;
    }
  </style>
</head>
<body>
<header>
  <h1>ğŸ½ï¸ ä»Šå¤©åƒä»€éº¼ï¼Ÿ</h1>
  <h1>è½‰ç›¤å¹«ä½ æ±ºå®š!</h1>
</header>
<nav>
  <a href="index.html">é¦–é </a>
  <a href="about_0527.html">é—œæ–¼æˆ‘å€‘</a>
  <a href="custom_0527.html">è‡ªè¨‚é¸é …</a>
</nav>
<main>
  <section>
    <h2>é¸æ“‡é¤åˆ¥</h2>
    <div class="meal-buttons">
      <button data-meal="æ—©é¤">æ—©é¤</button>
      <button data-meal="åˆé¤">åˆé¤</button>
      <button data-meal="æ™šé¤">æ™šé¤</button>
      <button data-meal="ç”œé»">ç”œé»</button>
    </div>
  </section>
  <div class="wheel-container">
    <canvas id="wheel"></canvas>
    <div class="arrow"></div>
  </div>
  <button class="spin-button">å•Ÿå‹•è½‰ç›¤ï¼</button>
  <div id="result"></div>
</main>
<footer>
  &copy; 20250528 å¤šåª’é«”-ç¶²é è¨­è¨ˆæœŸæœ«å ±å‘Š
</footer>
<script>
  const canvas = document.getElementById('wheel');
  const ctx = canvas.getContext('2d');
  canvas.width = 300;
  canvas.height = 300;

  const centerX = canvas.width / 2;
  const centerY = canvas.height / 2;
  const radius = canvas.width / 2 - 10;

  const defaultMeals = {
    æ—©é¤: ['é£¯ç³°', 'ç‡’é¤…æ²¹æ¢', 'è›‹é¤…','é‹ç‡’æ„éºµ','æ¼¢å ¡','è²æœ'],
    åˆé¤: ['ä¾¿ç•¶', 'ç‰›è‚‰éºµ', 'æ‹‰éºµ','é‹ç‡’æ„éºµ','å£½å¸','å’–å“©é£¯'],
    æ™šé¤: ['ç«é‹', 'å£½å¸', 'ç‚¸é›','ä¹¾éºµ','ç‚’é£¯','è…¸ç²‰'],
    ç”œé»: ['å†°æ·‡æ·‹', 'è±†èŠ±', 'è›‹ç³•','èµ·å¸è›‹ç³•','ä»™è‰','è»Šè¼ªé¤…']
  };

  const customMeals = JSON.parse(localStorage.getItem('customMeals') || '{}');

  const meals = {};
  for (let type in defaultMeals) {
    meals[type] = [...defaultMeals[type], ...(customMeals[type] || [])];
  }

  const buttons = document.querySelectorAll('.meal-buttons button');
  const spinBtn = document.querySelector('.spin-button');
  const resultDiv = document.getElementById('result');

  let currentOptions = [];
  let currentCategory = '';
  let angle = 0, spinSpeed = 0, animationId;

  buttons.forEach(button => {
    button.addEventListener('click', () => {
      buttons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');
      currentCategory = button.textContent;
      currentOptions = meals[currentCategory] || [];
      drawWheel(currentOptions);
      resultDiv.innerHTML = '';
    });
  });

  function drawWheel(options) {
    const sliceAngle = 2 * Math.PI / options.length;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.translate(centerX, centerY);
    ctx.rotate(angle);

    for (let i = 0; i < options.length; i++) {
      const startAngle = i * sliceAngle;
      const endAngle = (i + 1) * sliceAngle;

      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.fillStyle = i % 2 === 0 ? '#d9b382' : '#f4e1c1';
      ctx.arc(0, 0, radius, startAngle, endAngle);
      ctx.fill();

      // Draw text
      ctx.save();
      ctx.rotate(startAngle + sliceAngle / 2);
      ctx.fillStyle = '#5c4b3b';
      ctx.font = '16px Microsoft JhengHei';
      ctx.textAlign = 'right';
      ctx.fillText(options[i], radius - 10, 5);
      ctx.restore();
    }
    ctx.restore();
  }

  spinBtn.addEventListener('click', () => {
    if (animationId) cancelAnimationFrame(animationId);
    if (currentOptions.length === 0) {
      resultDiv.textContent = 'è«‹å…ˆé¸æ“‡é¤åˆ¥ï¼';
      return;
    }
    spinSpeed = Math.random() * 0.3 + 0.3;
    function animate() {
      if (spinSpeed > 0.01) {
        angle += spinSpeed;
        spinSpeed *= 0.98;
        drawWheel(currentOptions);
        animationId = requestAnimationFrame(animate);
      } else {
        const sliceAngle = 2 * Math.PI / currentOptions.length;
        const normalizedAngle = (2 * Math.PI - (angle % (2 * Math.PI))) % (2 * Math.PI);
        const selectedIndex = Math.floor(normalizedAngle / sliceAngle) % currentOptions.length;
        const selectedItem = currentOptions[selectedIndex];
        resultDiv.innerHTML = `æ¨è–¦ï¼š${selectedItem} <a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(selectedItem)}" target="_blank" rel="noopener noreferrer">ğŸ” æœå°‹åœ°åœ–</a>`;
      }
    }
    animate();
  });
</script>

</body>
</html>
